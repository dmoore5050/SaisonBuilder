#!/usr/bin/env ruby

require_relative 'bootstrap_ar'
require_relative 'libraries/style'
require_relative 'libraries/menu'
require_relative 'libraries/techniques'

database = ENV['FP_ENV'] || 'development'
connect_to database

case ARGV[0]
when nil
  Menu.render_menu
when 'style'
  Style.render_definition
when 'techniques'
  Techniques.render_list
when 'ingredients'
when 'add'
  recipe_name = ARGV[1]
  recipe = Recipe.new(name: recipe_name)
  if recipe.save
    puts 'Success!'
  else
    puts "Failure: #{recipe.errors.full_messages.join(", ")}"
  end
when 'list'
  recipes = Recipe.all
  recipes.each_with_index do |recipe, i|
   puts "#{i+1}. #{recipe.name}"
  end
when 'remove'
  recipe_name = ARGV[1]
  matching_recipes = Recipe.where(name: recipe_name).all
  matching_recipes.each do |recipe|
   recipe.destroy
  end
end
